#!/usr/bin/env bash

set -euo pipefail

setup_virtualenv() {
  local python_bin="$RTX_INSTALL_PATH/bin/python"
  VIRTUAL_ENV="$(eval "echo ${RTX_TOOL_OPTS__VIRTUALENV:-}")"
  if [ "$VIRTUAL_ENV" = "" ]; then
    return
  fi
  unset PYTHONHOME
  if [ ! -d "$VIRTUAL_ENV" ]; then
		echo "rtx-python: setting up virtualenv at $VIRTUAL_ENV" >&2
		"$python_bin" -m venv "$VIRTUAL_ENV"
	fi
  RTX_ADD_PATH="$(realpath "$VIRTUAL_ENV/bin")"
  export VIRTUAL_ENV RTX_ADD_PATH
}

setup_virtualenv
